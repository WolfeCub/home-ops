version: "3.5"
services:
  plex:
    image: linuxserver/plex
    networks:
      - hostnet
    volumes:
      - /homelab/plex/config:/config:Z
      - /storage/TV-shows:/data/tvshows:Z
      - /storage/Movies:/data/movies:Z
      - /storage/PW:/data/pw:Z
      - /homelab/plex/transcode:/transcode:Z
    environment:
      - PUID=1001
      - PGID=1001
      - ADVERTISE_IP=http://192.168.0.100:32400
    deploy:
      placement:
        constraints:
          - node.hostname == shirleytemple

  sonarr:
    image:  linuxserver/sonarr:latest
    networks:
      - webnet
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /storage/TV-shows:/tv
      - /homelab/sonarrconfig:/config
      - /homelab/transmission/downloads/complete:/downloads
    environment:
      - PUID=1001
      - PGID=1001
    deploy:
      labels:
        - traefik.http.routers.sonarr.rule=Host(`sonarr.${domain}`)
        - traefik.http.routers.sonarr.tls=true
        - traefik.http.services.sonarr-service.loadbalancer.server.port=8989
      placement:
        constraints:
          - node.hostname == shirleytemple

  radarr:
    image:  linuxserver/radarr:latest
    networks:
      - webnet
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /storage/Movies:/movies
      - /homelab/radarrconfig:/config
      - /homelab/transmission/downloads/complete:/downloads
    environment:
      - PUID=1001
      - PGID=1001
    deploy:
      labels:
        - traefik.http.routers.radarr.rule=Host(`radarr.${domain}`)
        - traefik.http.routers.radarr.tls=true
        - traefik.http.services.radarr-service.loadbalancer.server.port=7878
      placement:
        constraints:
          - node.hostname == shirleytemple

  jackett:
    image:  linuxserver/jackett:latest
    networks:
      - webnet
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /homelab/jackett/config:/config
      - /homelab/jackett/downloads:/downloads
    environment:
      - PUID=1002
      - PGID=1003
    deploy:
      labels:
        - traefik.http.routers.jackett.rule=Host(`jackett.${domain}`)
        - traefik.http.routers.jackett.tls=true
        - traefik.http.services.jackett-service.loadbalancer.server.port=9117
      placement:
        constraints:
          - node.hostname == shirleytemple

  #hydra2:
  #  image: linuxserver/hydra2
  #  networks:
  #    - webnet
  #  volumes:
  #    - /homelab/hydra/config:/config
  #    - /homelab/hydra/downloads:/downloads
  #  labels:
  #    - traefik.backend=hydra2
  #    - traefik.frontend.rule=Host:hydra.${domain}
  #    - traefik.port=5076
  #    - traefik.docker.network=webnet
  #  environment:
  #    - PUID=1002
  #    - PGID=1003

networks:
  hostnet:
    name: "host"
    external: true
  webnet:
    external: true
