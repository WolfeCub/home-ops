version: "3.5"
services:
  traefik:
    image: traefik:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /storage/homelab/traefikconfig/traefik.toml:/traefik.toml
      - /storage/homelab/traefikconfig/acme.json:/acme.json
      - /etc/letsencrypt:/ssl
    labels:
        - traefik.backend=traefik
        - traefik.frontend.rule=Host:traefik.house20.ca
        - traefik.port=8080
        - traefik.docker.network=webnet
        - traefik.frontend.redirect.entryPoint=https
    networks:
      - webnet
    ports:
      - 80:80
      - 443:443
      - 8080:8080

  portainer:
    image: portainer/portainer
    command: -H unix:///var/run/docker.sock
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /storage/homelab/portainerdata:/data
    networks:
      - webnet
    labels:
        - traefik.backend=portainer
        - traefik.frontend.rule=Host:portainer.house20.ca
        - traefik.port=9000
        - traefik.docker.network=webnet
        - traefik.frontend.redirect.entryPoint=https

  heimdall:
    image: linuxserver/heimdall:latest
    volumes:
        - /heimdallconfig:/config
    labels:
        - traefik.backend=heimdall
        - traefik.frontend.rule=Host:dashboard.house20.ca
        - traefik.docker.network=webnet
        - traefik.port=443
        - traefik.protocol=https
    environment:
        - PUID=1002
        - PGID=1003
        - TZ=America/New_York
    networks:
      - webnet

  plex:
    image: linuxserver/plex
    ports:
      - 32400:32400
      - 32400:32400/udp
      - 32469:32469
      - 32469:32469/udp
      - 5353:5353/udp
      - 1900:1900/udp
    networks:
      - webnet
    volumes:
      - /plexconfig:/config:Z
      - /storage/media/tv-shows:/data/tvshows:Z
      - /storage/media/movies:/data/movies:Z
      - /storage/homelab/plextranscode:/transcode:Z
    labels:
      - traefik.backend=plex
      - traefik.frontend.rule=Host:plex.house20.ca
      - traefik.port=32400
      - traefik.docker.network=webnet
      - traefik.frontend.redirect.entryPoint=https
    environment:
      - PUID=1002
      - PGID=1003

  tautulli:
    image: linuxserver/tautulli
    networks:
      - webnet
    volumes:
      - "/plexconfig/Library/Application Support/Plex Media Server/Logs:/logs:ro"
      - /tautulliconfig:/config:Z
    labels:
      - traefik.backend=tautulli
      - traefik.frontend.rule=Host:tautulli.house20.ca
      - traefik.port=8181
      - traefik.docker.network=webnet
      - traefik.frontend.redirect.entryPoint=https
    environment:
      - PUID=1002
      - PGID=1003

  sonarr:
    image:  linuxserver/sonarr:latest
    networks:
      - webnet
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /storage/media/tv-shows:/tv
      - /storage/homelab/sonarrconfig:/config
      - /storage/homelab/transmission/downloads/complete:/downloads
      #- /storage/homelab/nzbgetdownloads:/downloads
    labels:
      - traefik.backend=sonarr
      - traefik.frontend.rule=Host:sonarr.house20.ca
      - traefik.port=8989
      - traefik.docker.network=webnet
      - traefik.frontend.redirect.entryPoint=https
    environment:
      - PUID=1002
      - PGID=1003

  radarr:
    image:  linuxserver/radarr:latest
    networks:
      - webnet
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /storage/media/movies:/movies
      - /storage/homelab/radarrconfig:/config
      - /storage/homelab/transmission/downloads/complete:/downloads
      #- /storage/homelab/nzbgetdownloads:/downloads
    labels:
      - traefik.backend=radarr
      - traefik.frontend.rule=Host:radarr.house20.ca
      - traefik.port=7878
      - traefik.docker.network=webnet
      - traefik.frontend.redirect.entryPoint=https
    environment:
      - PUID=1002
      - PGID=1003

  jackett:
    image:  linuxserver/jackett:latest
    networks:
      - webnet
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /storage/homelab/jackett/config:/config
      - /storage/homelab/jackett/downloads:/downloads
    labels:
      - traefik.backend=jackett
      - traefik.frontend.rule=Host:jackett.house20.ca
      - traefik.port=9117
      - traefik.docker.network=webnet
      - traefik.frontend.redirect.entryPoint=https
    environment:
      - PUID=1002
      - PGID=1003

  file-server:
    image: halverneus/static-file-server
    volumes:
      - /staticwww:/web
    networks:
      - webnet
    labels:
      - traefik.backend=file-server
      - traefik.frontend.rule=Host:static.house20.ca
      - traefik.port=8080
      - traefik.docker.network=webnet

networks:
  webnet:
    external: true
