version: "3.5"
services:
  nextcloud:
    image: linuxserver/nextcloud
    networks:
      - webnet
    environment:
      - PUID=1001
      - PGID=1001
      - TZ=America/Toronto
    volumes:
      - /storage/nextcloud/config:/config
      - /storage/nextcloud/data:/data
    deploy:
      placement:
        constraints: [node.hostname == appletini]
      labels:
        - traefik.backend=nextcloud
        - traefik.frontend.rule=Host:storage.${domain}
        - traefik.port=80
        - traefik.docker.network=webnet
        - traefik.frontend.redirect.entryPoint=https

networks:
  webnet:
    external: true
